{% extends 'knotis/layout/master.html' %}
{% load thumbnail %}
{% load render_template_fragment %}
{% block title %}Knotis - Be in the kno!{% endblock title %}
{% block first %}{% endblock first %}
{% block header %}
{% render_fragment header %}
{% endblock header %}
{% block content %}
{% load crispy_forms_tags %}
<div class="container-fluid">

  <input id="data-static-url" type="hidden" data-static-url="{{ STATIC_URL }}" />
  <div id="id-profile-cover" class="row-fluid">
    {% thumbnail profile_banner.image.image '2560x500' crop=profile_banner.crop as header %}
    <img src="{{ header.url }}" alt="header image" id="profile-header" />
    {% endthumbnail %}
    <div class="span12">
      
      {% if is_manager %}
      {% thumbnail profile_badge.image.image '170x170' crop=profile_badge.crop as img %}
      <a class="change-profile-badge-link"bo>
	<img src="{{ img.url }}" class="img-circle" id="profile-badge"/>
      </a>
      {% empty %}
      <img data-add-image src="{{ default_profile_logo_uri }}" class="img-circle" />
      {% endthumbnail %}
      {% else %}
      {% thumbnail profile_badge.image.image '170x170' crop=profile_badge.crop as img %}
      <img src="{{ img.url }}" class="img-circle" />
      {% empty %}
      <img src="{{ default_profile_logo_uri }}" class="img-circle" />
      {% endthumbnail %}
      {% endif %}

      <div class="row-fluid">
        <div id="id-profile-title" class="span12">
	  {% if is_manager %}
          <h2 
	     class="updateable-name" 
	     data-establishment-id="{{ establishment.id }}" 
	     data-identity-type="{{ establishment.identity_type }}"
	     data-establishment-parent-id="{{ establishment_parent.id }}">{{ establishment.name }}</h2>
	  {% else %}
          <h2>{{ establishment.name }}</h2>
	  {% endif %}
        </div>
      </div>
      <div id="id-profile-contact" class="row">
        <strong>

	  <div id="id-profile-contact-address">
	    {% if is_manager %}
	    <a class="update-address-link">{{ address }}</a>
	    {% else %}
	    {{ address }}
	    {% endif %}
	  </div>
	  <ul class="unstyled">
	    {% for endpoint in endpoints %}
	    {% if endpoint.value %}
	    <li class="{% if is_manager %}editable{% endif %} establishment-endpoint" 
		data-establishment-id="{{ establishment.id }}"
		data-endpoint-endpoint-id="{{ endpoint.id }}"
		data-endpoint-endpoint-type-name="{{ endpoint.endpoint_type_name }}">
	      {% if not is_manager %}<a href="{{ endpoint.uri }}">{% endif %}
                {% if endpoint.display %}
		{{ endpoint.display }}
		{% else %}
		{{ endpoint.value }}
		{% endif %}
	      {% if not is_manager %}</a>{% endif %}
	    </li>
	    {% else %}
	    {% if is_manager %}
	    <li class="editable establishment-endpoint" 
		data-establishment-parent-id="{{ establishment_parent.id }}"
		data-endpoint-endpoint-type-name="{{ endpoint.endpoint_type_name }}">
	      add {{ endpoint.endpoint_type_name }}
	    </li>
	    {% endif %}
	    {% endif %}
	    {% endfor %}
          </ul>
        </strong>
      </div>
      <div id="id-profile-action" class="row">
      </div>
      {% if is_manager %}
      <a class="change-profile-cover-link">Change Cover Image</a>
      {% endif %}
    </div>
  </div>
  {% render_fragment nav_top %}
  <div id="id-profile-spacer" class="row-fluid"><p class="span12">&nbsp;</p></div>
  <div class="row-fluid">
    <div class="span2">
      {% render_fragment nav_side %}
    </div>

    <!-- render_fragment profile_establishment_grid -->

    <div class="span10">
      {{ nav_top_content }}
    </div>

  </div>
</div>
<div id="id-identity-id" data-identity-id="{{ establishment.id }}" class="hide" >&nbsp;</div>

{% endblock content %}
{% block footer %}{% endblock footer %}
{% block last %}{% endblock last %}
