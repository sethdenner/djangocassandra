{% extends 'knotis/layout/master.html' %}
{% load thumbnail %}
{% load render_template_fragment %}
{% block title %}Knotis - Be in the kno!{% endblock title %}
{% block first %}{% endblock first %}
{% block header %}
{% render_fragment header %}
{% render_fragment nav_top %}
{% endblock header %}
{% block content %}
{% load crispy_forms_tags %}
<div class="container-fluid">

  {% thumbnail profile_header.image.image '2560x281' crop=profile_header.crop as header %}
  <img src="{{ header.url }}" />
  {% empty %}
  Nothing
  {% endthumbnail %}
  <div id="id-profile-cover" class="row-fluid" style="background-image=url('{{ header.url }}');" />
    <div class="span12">
      {% thumbnail profile_badge.image.image '170x170' crop=profile_badge.crop as img %}
      <img src="{{ img.url }}" class="img-circle" />
      {% empty %}
      <img data-add-image src="{{ default_profile_logo_uri }}" class="img-circle" />
      {% endthumbnail %}
      <div class="row-fluid">
        <div id="id-profile-title" class="span12">
          <h2>{{ establishment.name }}</h2>
        </div>
      </div>
      <div id="id-profile-contact" class="row">
        <strong>

	  <div id="id-profile-contact-address">
	    {% if is_manager %}
	    <a class="update-address-link">{{ address }}</a>
	    {% else %}
	    {{ address }}
	    {% endif %}
	  </div>
	  <ul class="unstyled">
            <li>contact@example.com</li>
            <li>&nbsp;</li>
            <li>twitter</li>
            <li>facebook</li>
          </ul>
        </strong>
      </div>
      <div id="id-profile-action" class="row">
      </div>

      <a class="change-profile-cover-link">Change Cover Image</a>
      <script type="text/javascript">
	document.addEventListener( "DOMContentLoaded", function(){
	  $('a.change-profile-cover-link').on('click', function(){
            $.get(
              '/image/upload/',
	      {},
	      function(data, status, jqxhr){
                console.log(status);

                if(data.errors){
                  console.log('errors', data.errors);
                  return;
                }

	        $('#modal-box').html(data);

                $('#object-id').attr('data-object-id', '{{ establishment.id }}');
                $('#modal-box').modal({
                  backdrop: true,
                  keyboard: true
                });
                
                $('#file-uploader').sickle({
                  do_upload: true,
                  params: {
                    type: 'image'
                  },
                  aspect: 9,
                  done: function(data, status, jqxhr){

                  },
                  related_object_id: '{{ establishment.id }}'
                });
	      }
            );
          });
	});
      </script>
    </div>
  </div>

  <div id="id-profile-spacer" class="row-fluid"><p class="span12">&nbsp;</p></div>
  <div class="row-fluid">
    <div class="span2">
      {% render_fragment nav_side %}
    </div>
    <div class="span10">
      {% render_fragment establishment_profile_grid %}
    </div>
  </div>
</div>
<div id="id-identity-id" data-identity-id="{{ establishment.id }}" class="hide" >&nbsp;</div>
{% endblock content %}
{% block footer %}{% endblock footer %}
{% block last %}{% endblock last %}
