{% load thumbnail %}
<div class="carousel-wrapper">
  <h4>Photos</h4>
  {% if is_manager %}<a class="upload-photo" data-business-id="{{ establishment_parent.id }}">Upload Photos</a>{% endif %}
  <div id="about_carousel" class="carousel slide" style="width:500px; height: 400px;">
    <!-- Indicators -->
    <ol class="carousel-indicators">
      {% for index, _ in images %}
      <li data-target="#about_carousel" data-slide-to="{{ index }}" {% if index == 0 %}class="active"{% endif %} style="list-style: none;"></li>
      {% endfor %}
    </ol>
    
    <!-- Wrapper for slides -->
    <div class="carousel-inner">
      {% for index, image in images %}
      {% thumbnail image.image.image '500x400' crop=image.crop as img %}
      <div class="item {% if index == 0 %}active{% endif %}">
	<div style="display:block; width:500px; height:400px; overflow:hidden; background:url('{{ img.url }}') no-repeat;"></div>
	<!--<img style="width:500px; height:auto;" src="{{ img.url }}" />-->
      </div>
      {% endthumbnail %}
      {% endfor %}
    </div>
  </div>
  
</div>

<script>
(function($){
    // carousel
    $('#about_carousel').carousel({
        interval: 5000
    });
    
    $('a.upload-photo').click(function(event){
	event.preventDefault();
	var identity_id = $(this).attr('data-business-id');
	console.log('identity_id', identity_id);

	$.ajaxmodal({
	    href: '/image/upload',
	    modal_settings: {
		backdrop: 'static'
	    },
	    on_open: function(data, status, request){
		
		$('#file-uploader').sickle({
		    do_upload: true,
		    params: {
			type: 'image'
		    },
		    aspect: 1.25,
		    related_object_id: identity_id,
		    context: 'business_profile_carousel',
		    primary: false,
		    done: function(data){
			$('modal-box').modal('hide');
		    }
		});
	    }
        });
    });

})(jQuery);
</script>
